#配置 zabbix 监控 MySQL
#ZABBIX 默认提供了 MYSQL 的监控模板

#数据库用户授权
#mysql> grant usage on *.* to zabbix@'%' identified by '123456';
#mysql> flush privileges;
#cp /usr/local/src/zabbix-3.4.3/conf/zabbix_agentd/userparameter_mysql.conf  /usr/local/zabbix/etc/zabbix_agentd.conf.d/

#vim /usr/local/zabbix/etc/zabbix_agentd.conf
#Include=/usr/local/zabbix/etc/zabbix_agentd.conf.d/*.conf	#启用并修改#建立数据库和 zabbix 的链接信息
# vim /usr/local/zabbix/etc/.my.cnf

# #Zabbix Agent 
#[mysql] 
#host=localhost
#user=zabbix 
#password=123456
#socket= /var/lib/mysql/mysql.sock
#[mysqladmin] 
#host=localhost
#user=zabbix
#password=123456
#socket= /var/lib/mysql/mysql.sock


# vim /usr/local/zabbix/etc/zabbix_agentd.conf.d/userparameter_mysql.conf
#将 HOME=/var/lib/zabbix 全部改成 HOME=/usr/local/zabbix/etc/

## For all the following commands HOME should be set to the directory that has .my.cnf file with password information.（提示目录下必须有.my.cnf）

#/etc/init.d/zabbix_agentd restart

#模板应用主机：
#配置--主机--名称
#模板--链接指示器选择Template DB MySQL--添加--更新
#监测中--最新数据--主机localhost--应用集mysql--过滤


#Zabbix邮件报警配置：
#邮件服务可以使用系统自带的邮件服务来发送邮件或者使用其他邮件服务调用第三方邮件来发送警告邮件
#调用第三方邮件服务来发送邮件：

#第一步：首先安装mailx组件并配置好能够通过三方邮箱发送邮件
#yum install mailx
#编辑mailx的配置文件
#vi /etc/mail.rc
#在最末尾添加如下信息
#set from=glowworm0305@163.com
#set smtp=smtp.163.com
#set smtp-auth-user=glowworm0305@163.com
#set smtp-auth-password=你的密码 注意：此为163邮箱设置的客户端授权密码
#set smtp-auth=login  

#保存退出后测试邮件是否能够正常发送出去
#echo "zabbix test mail" |mailx -s "zabbix"glowworm0305@qq.com



#在zabbix服务端写邮件发送脚本：
#cd /usr/local/zabbix/share/zabbix/alertscripts/
# vim sendmail.sh
##!/bin/bash
#messages=`echo $3 | tr "\r\n" "\n"`
#subject=`echo $2 | tr "\r\n" "\n"`
#echo "${messages}"|mailx -s "${subject}" $1 >>/tmp/Sendmail.log 2>&1

#chown zabbix.zabbix sendmail.sh 
#chmod +x  sendmail.sh


#修改主配置文件，让服务读取到这个脚本
#vim /usr/local/zabbix/etc/zabbix_server.conf
#修改：# AlertScriptsPath=${datadir}/zabbix/alertscripts
#为AlertScriptsPath=/usr/local/zabbix/share/zabbix/alertscripts

#chmod 777 /tmp/sendmail.log

#测试发送脚本
#/usr/local/zabbix/share/zabbix/alertscripts/sendmail.sh glowworm0305@136.com "测试邮件标题" "测试邮件内容"


#页面添加:
#配置--报警媒介类型--创建媒介类型
#名称sendmail--类型：脚本--脚本名称sendmail.sh--脚本参数{ALERT.SENDTO}{ALERT.SUBJECT}{ALERT.MESSAGE}

#zabbix3.0之后，可以自定义参数了。所以不写参数，它是不会传参数的。在2.x版本不存在这个问题，默认会传3个参数。

#配置--用户--别名--报警媒介--添加--收件人glowworm0305@163.com
#配置--动作--创建动作
#动作名称：Action-Email
#操作
#默认接收人：故障{TRIGGER.STATUS},服务器:{HOSTNAME1}发生:      {TRIGGER.NAME}故障!
#默认信息：
#告警主机:{HOSTNAME1}
#告警时间:{EVENT.DATE} {EVENT.TIME}
#告警等级:{TRIGGER.SEVERITY}
#告警信息: {TRIGGER.NAME}
#告警项目:{TRIGGER.KEY1}
#问题详情:{ITEM.NAME}:{ITEM.VALUE}
#当前状态:{TRIGGER.STATUS}:{ITEM.VALUE1}
#事件 ID:{EVENT.ID}

#操作细节
#发送到用户Admin(Zabbix Administrator)--仅送到sendmail--添加

#恢复操作
#默认接收人：已恢复！{TRIGGER.STATUS}, 服务器:{HOSTNAME1}: {TRIGGER.NAME}
#恢复信息：
#告警主机:{HOSTNAME1}
#告警时间:{EVENT.DATE} {EVENT.TIME}
#告警等级:{TRIGGER.SEVERITY}
#告警信息: {TRIGGER.NAME}
#告警项目:{TRIGGER.KEY1}
#问题详情:{ITEM.NAME}:{ITEM.VALUE}
#当前状态:{TRIGGER.STATUS}:{ITEM.VALUE1}
#事件 ID:{EVENT.ID}

#操作细节
#发送到用户Admin(Zabbix Administrator)--仅送到sendmail--添加--更新

#测试，关闭 zabbix 客户端服务 zabbix_agentd
# /etc/init.d/zabbix_agentd stop
#结果：延迟比较大，大概要5-10分钟可以在日志看送达状态:
#报表--动作日志

